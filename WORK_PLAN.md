# Supabase Stripe ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚µã‚¤ãƒˆé–‹ç™ºè¨ˆç”»

## ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
æœ€æ–°æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆNext.js App Routerã€Supabaseã€Stripeã€Tailwind CSS v4ã€shadcnï¼‰ã‚’ä½¿ç”¨ã—ãŸEã‚³ãƒãƒ¼ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®æ§‹ç¯‰

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### ãƒ‡ãƒ¼ã‚¿ç®¡ç†æ–¹é‡
- **é¡§å®¢æƒ…å ±**: Supabaseï¼ˆèªè¨¼ã€ä½æ‰€ã€é…é€æƒ…å ±ï¼‰+ Stripeï¼ˆcustomer_idç´ä»˜ã‘ï¼‰
- **å•†å“æƒ…å ±**: Supabaseï¼ˆå®Œå…¨ç®¡ç†ï¼‰
- **æ±ºæ¸ˆæƒ…å ±**: Stripeï¼ˆæ©Ÿå¯†æƒ…å ±ï¼‰+ Supabaseï¼ˆæ³¨æ–‡å±¥æ­´ï¼‰
- **ç”»åƒç®¡ç†**: Supabase Storageï¼ˆå•†å“ç”»åƒï¼šãƒ‘ãƒ–ãƒªãƒƒã‚¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»åƒï¼šãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆï¼‰

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ
- Row Level Security (RLS) å®Ÿè£…
- Stripe Webhookç½²åæ¤œè¨¼
- å‹å®‰å…¨ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆanyå‹ç¦æ­¢ï¼‰

## ğŸ“ ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ
```
src/
  app/
    (auth)/
      login/
      register/
      profile/
    (shop)/
      products/
        [id]/
      cart/
      checkout/
    api/
      stripe/
        webhook/
        create-checkout-session/
    globals.css
    layout.tsx
    page.tsx
  components/
    ui/ (shadcn)
    auth/
    product/
    cart/
    checkout/
  lib/
    supabase/
      client.ts
      server.ts
      types.ts
    stripe/
      client.ts
      server.ts
      webhook.ts
    utils.ts
    validations.ts
  types/
    database.types.ts
    stripe.types.ts
  hooks/
    useAuth.ts
    useCart.ts
    useProducts.ts
```

## ğŸš€ ä½œæ¥­ã‚»ã‚¯ã‚·ãƒ§ãƒ³

### ã‚»ã‚¯ã‚·ãƒ§ãƒ³1: ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ»åŸºç›¤æ§‹ç¯‰ âœ… å®Œäº†
- [x] ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»æ›´æ–°
- [x] Tailwind CSS v4è¨­å®š
- [x] TypeScriptè¨­å®š
- [x] ç’°å¢ƒå¤‰æ•°è¨­å®š
- [x] Supabaseæ¥ç¶šè¨­å®š
- [x] Stripeæ¥ç¶šè¨­å®š

### ã‚»ã‚¯ã‚·ãƒ§ãƒ³2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆãƒ»RLSå®Ÿè£… âœ… å®Œäº†
- [x] Supabaseãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆãƒ»ä½œæˆ
- [x] Row Level Security (RLS) ãƒãƒªã‚·ãƒ¼å®Ÿè£…
- [x] TypeScriptå‹å®šç¾©ç”Ÿæˆ
- [x] ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ä½œæˆSQL

### ã‚»ã‚¯ã‚·ãƒ§ãƒ³3: èªè¨¼ã‚·ã‚¹ãƒ†ãƒ  âœ… å®Œäº†
- [x] Supabaseèªè¨¼è¨­å®š
- [x] èªè¨¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
- [x] ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
- [x] èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

### ã‚»ã‚¯ã‚·ãƒ§ãƒ³4: å•†å“ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  âœ… å®Œäº†
- [x] å•†å“è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [x] å•†å“è©³ç´°ãƒšãƒ¼ã‚¸
- [x] å•†å“ç”»åƒç®¡ç† (Supabase Storage)
- [x] å•†å“æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

### ã‚»ã‚¯ã‚·ãƒ§ãƒ³5: ã‚«ãƒ¼ãƒˆãƒ»æ³¨æ–‡ã‚·ã‚¹ãƒ†ãƒ  âœ… å®Œäº†
- [x] ã‚«ãƒ¼ãƒˆæ©Ÿèƒ½å®Ÿè£… (use-cart.ts)
- [x] ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (cart-item-card.tsx)
- [x] ã‚«ãƒ¼ãƒˆã‚µãƒãƒªãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (cart-summary.tsx)
- [x] ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸å®Ÿè£… (/cart/page.tsx)
- [x] ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³è¿½åŠ 
- [x] å•†å“è©³ç´°ãƒ»ã‚«ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã«ã‚«ãƒ¼ãƒˆãƒœã‚¿ãƒ³çµ±åˆ
- [x] æ³¨æ–‡ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ
- [x] åœ¨åº«ç®¡ç†ï¼ˆinventory functionsï¼‰
- [x] æ³¨æ–‡ç®¡ç†ãƒ•ãƒƒã‚¯å®Ÿè£… (use-orders.ts)
- [x] ä½æ‰€ç®¡ç†ãƒ•ãƒƒã‚¯å®Ÿè£… (use-addresses.ts)
- [x] ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãƒšãƒ¼ã‚¸å®Ÿè£… (/checkout/page.tsx)
- [x] æ³¨æ–‡å±¥æ­´ãƒšãƒ¼ã‚¸å®Ÿè£… (/orders/page.tsx)
- [x] æ³¨æ–‡è©³ç´°ãƒšãƒ¼ã‚¸å®Ÿè£… (/orders/[id]/page.tsx)
- [x] ã‚«ãƒ¼ãƒˆçŠ¶æ…‹åŒæœŸå•é¡Œä¿®æ­£ (addToCartå¾Œã®å³æ™‚åæ˜ )
- [x] ã‚«ãƒ¼ãƒˆãƒªãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½è¿½åŠ  (reloadCart)
- [x] åœ¨åº«ç®¡ç†ï¼ˆinventory functionsï¼‰
- [x] æ³¨æ–‡ç®¡ç†ãƒ•ãƒƒã‚¯å®Ÿè£… (use-orders.ts)
- [x] ä½æ‰€ç®¡ç†ãƒ•ãƒƒã‚¯å®Ÿè£… (use-addresses.ts)
- [x] ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãƒšãƒ¼ã‚¸å®Ÿè£… (/checkout/page.tsx)
- [x] æ³¨æ–‡å±¥æ­´ãƒšãƒ¼ã‚¸å®Ÿè£… (/orders/page.tsx)
- [x] æ³¨æ–‡è©³ç´°ãƒšãƒ¼ã‚¸å®Ÿè£… (/orders/[id]/page.tsx)

### ã‚»ã‚¯ã‚·ãƒ§ãƒ³6: Stripeæ±ºæ¸ˆã‚·ã‚¹ãƒ†ãƒ  ğŸ”„ é€²è¡Œä¸­
- [x] Stripe Elementså®Ÿè£…
- [x] æ±ºæ¸ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆAPI (/api/stripe/create-checkout-session)
- [x] Webhookå®Ÿè£… (Next.js API Route â†’ Supabase Edge Functionç§»è¡Œä¸­)
- [x] æ±ºæ¸ˆå®Œäº†å‡¦ç† (checkout.session.completed)
- [x] æ±ºæ¸ˆæˆåŠŸãƒšãƒ¼ã‚¸ (/checkout/success)
- [x] ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±å–å¾—API (/api/stripe/checkout-session)
- [x] ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®Stripeé€£æº
- [x] æ³¨æ–‡è‡ªå‹•ä½œæˆãƒ»åœ¨åº«æ¸›ç®—ãƒ»ã‚«ãƒ¼ãƒˆã‚¯ãƒªã‚¢
- [x] Supabase Edge Functionä½œæˆ (/supabase/functions/stripe-webhook/)
- [ ] Edge Function ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»è¨­å®š
- [ ] Stripe Webhook URLæ›´æ–°

### ã‚»ã‚¯ã‚·ãƒ§ãƒ³7: UI/UXãƒ‡ã‚¶ã‚¤ãƒ³
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
- [ ] ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°UI
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹

### ã‚»ã‚¯ã‚·ãƒ§ãƒ³8: ãƒ†ã‚¹ãƒˆãƒ»æœ€é©åŒ–
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼
- [ ] å‹•ä½œãƒ†ã‚¹ãƒˆ

## ğŸ“‹ æŠ€è¡“ä»•æ§˜

### ä½¿ç”¨æŠ€è¡“
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Next.js 15 (App Router), React 18
- **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**: Tailwind CSS v4, shadcn/ui
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Supabase (PostgreSQL, Auth, Storage)
- **æ±ºæ¸ˆ**: Stripe (Elements, Webhooks)
- **å‹å®‰å…¨æ€§**: TypeScript, Zod
- **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼**: Bun

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„
- anyå‹ä½¿ç”¨ç¦æ­¢
- type-only importsä½¿ç”¨ (`import type`)
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: `throw new Error()` â†’ `catch (error: unknown)` â†’ `instanceof Error`
- sonnerä½¿ç”¨ï¼ˆtoastå»ƒæ­¢ï¼‰

## ğŸ“ æ³¨æ„äº‹é …
- AIãƒ¢ãƒ‡ãƒ«ä¸Šé™å›é¿ã®ãŸã‚ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³å˜ä½ã§ä½œæ¥­
- ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°æ™‚ã¯åå‰ã‚’å‡ºåŠ›
- ãƒ•ãƒªãƒ¼ç´ æç”»åƒä½¿ç”¨
- Context7ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§
- æ—¥æœ¬èªå‡ºåŠ›ã€è‹±èªæ€è€ƒ
- ä¿¯ç°çš„ãªç›®ã§é–‹ç™º


## ğŸ“ˆ é€²æ—ç®¡ç†
å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³å®Œäº†æ™‚ã«ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’æ›´æ–°ã—ã€æ¬¡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¸é€²è¡Œ
